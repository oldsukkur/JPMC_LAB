!RANCID-CONTENT-TYPE: arista
!
terminal length 60
!
daemon TerminAttr
   exec /usr/bin/TerminAttr -cvaddr=192.168.0.5:9910 -cvauth=token,/tmp/token -cvvrf=MGMT -smashexcludes=ale,flexCounter,hardware,kni,pulse,strata -ingestexclude=/Sysdb/cell/1/agent,/Sysdb/cell/2/agent -taillogs
   no shutdown
!
switchport default mode routed
!
vlan internal order ascending range 3500 4000
!
no ip igmp snooping
!
event-monitor
!
load-interval default 5
!
interface defaults
   ethernet
      shutdown
   mtu 1500
!
transceiver qsfp default-mode 4x10G
!
errdisable recovery interval 30
!
service routing protocols model multi-agent
!
hostname DC1-CL2
ip name-server 10.255.0.2
!
ntp server 0.pool.ntp.org prefer
!
spanning-tree mode mstp
no spanning-tree vlan-id 4093-4094
spanning-tree mst 0 priority 4096
!
aaa authentication login default local
aaa authentication login console local
aaa authentication policy on-failure log
aaa authentication policy on-success log
aaa authorization serial-console
aaa authorization exec default local
aaa authorization commands all default local
!
enable password sha512 $6$tPb.0ryluOpDGa9X$o29dqtH/bSdvachSlPNe2QbXNZXo2b/xHNCECdXrGJ0z91yrZdDDwczHmzDyVZtq6IeG23cTGD24Tfi0Nyh/R.
no aaa root
!
username admin privilege 15 role network-admin secret sha512 $6$tPb.0ryluOpDGa9X$o29dqtH/bSdvachSlPNe2QbXNZXo2b/xHNCECdXrGJ0z91yrZdDDwczHmzDyVZtq6IeG23cTGD24Tfi0Nyh/R.
username cvpadmin privilege 15 role network-admin secret sha512 $6$tPb.0ryluOpDGa9X$o29dqtH/bSdvachSlPNe2QbXNZXo2b/xHNCECdXrGJ0z91yrZdDDwczHmzDyVZtq6IeG23cTGD24Tfi0Nyh/R.
!
clock timezone US/Central
!
vlan 10
   name V10-T-A-VRF-RED
!
vlan 20
   name V20-T-B-VRF-BLUE
!
vlan 30
   name V30-T-A-VRF-RED
!
vlan 40
   name V40-T-B-VRF-BLUE
!
vlan 4000
   name MLAG_iBGP_RED
   trunk group LEAF_PEER_L3
!
vlan 4001
   name MLAG_iBGP_BLUE
   trunk group LEAF_PEER_L3
!
vlan 4093
   name LEAF_PEER_L3
   trunk group LEAF_PEER_L3
!
vlan 4094
   name MLAG_PEER
   trunk group MLAG
!
vrf instance BLUE
!
vrf instance MGMT
!
vrf instance RED
!
interface Port-Channel3
   description MLAG_PEER_DC1-CL1_Po3
   no shutdown
   switchport
   switchport mode trunk
   switchport trunk group LEAF_PEER_L3
   switchport trunk group MLAG
!
interface Port-Channel4
   description Host1_PortChannel10
   no shutdown
   switchport
   switchport trunk allowed vlan 10,20,30,40
   switchport mode trunk
   mlag 4
   spanning-tree portfast
!
interface Port-Channel5
   description Host2_PortChannel10
   no shutdown
   switchport
   switchport trunk allowed vlan 10,20,30,40
   switchport mode trunk
   mlag 5
   spanning-tree portfast
!
interface Ethernet1
   description P2P_LINK_TO_DC1-SP1_Ethernet2
   no shutdown
   mtu 1500
   speed forced 100g
   no switchport
   ip address 192.168.1.5/31
   ip ospf network point-to-point
   ip ospf area 0.0.0.0
!
interface Ethernet2
   description P2P_LINK_TO_DC1-SP2_Ethernet2
   no shutdown
   mtu 1500
   speed forced 100g
   no switchport
   ip address 192.168.1.7/31
   ip ospf network point-to-point
   ip ospf area 0.0.0.0
!
interface Ethernet3
   description MLAG_PEER_DC1-CL1_Ethernet3
   no shutdown
   speed 100g
   channel-group 3 mode active
!
interface Ethernet4
   description Host1_Ethernet2
   no shutdown
   speed 10g
   channel-group 4 mode active
!
interface Ethernet5
   description Host2_Ethernet2
   no shutdown
   speed 10g
   channel-group 5 mode active
!
interface Loopback0
   description EVPN_Overlay_Peering
   no shutdown
   ip address 192.168.100.2/32
   ip ospf area 0.0.0.0
!
interface Loopback1
   description VTEP_VXLAN_Tunnel_Source
   no shutdown
   ip address 192.168.200.1/32
   ip ospf area 0.0.0.0
!
interface Loopback100
   description RED_VTEP_DIAGNOSTICS
   no shutdown
   vrf RED
   ip address 10.100.100.2/32
!
interface Loopback101
   description BLUE_VTEP_DIAGNOSTICS
   no shutdown
   vrf BLUE
   ip address 10.100.101.2/32
!
interface Management1
   description oob_management
   no shutdown
   vrf MGMT
   ip address 192.168.0.103/24
!
interface Vlan10
   description V10-T-A-VRF-RED
   no shutdown
   vrf RED
   ip address virtual 10.10.10.254/24
!
interface Vlan20
   description V20-T-B-VRF-BLUE
   no shutdown
   vrf BLUE
   ip address virtual 10.10.20.254/24
!
interface Vlan30
   description V30-T-A-VRF-RED
   no shutdown
   vrf RED
   ip address virtual 10.10.30.254/24
!
interface Vlan40
   description V40-T-B-VRF-BLUE
   no shutdown
   vrf BLUE
   ip address virtual 10.10.40.254/24
!
interface Vlan4000
   description MLAG_PEER_L3_iBGP: vrf RED
   no shutdown
   mtu 1500
   vrf RED
   ip address 172.16.1.1/31
!
interface Vlan4001
   description MLAG_PEER_L3_iBGP: vrf BLUE
   no shutdown
   mtu 1500
   vrf BLUE
   ip address 172.16.1.1/31
!
interface Vlan4093
   description MLAG_PEER_L3_PEERING
   no shutdown
   mtu 1500
   ip address 172.16.1.1/31
   ip ospf network point-to-point
   ip ospf area 0.0.0.0
!
interface Vlan4094
   description MLAG_PEER
   no shutdown
   mtu 1500
   no autostate
   ip address 172.16.0.1/31
!
interface Vxlan1
   description DC1-CL2_VTEP
   vxlan source-interface Loopback1
   vxlan virtual-router encapsulation mac-address mlag-system-id
   vxlan udp-port 4789
   vxlan vlan 10 vni 10010
   vxlan vlan 20 vni 10020
   vxlan vlan 30 vni 10030
   vxlan vlan 40 vni 10040
   vxlan vrf BLUE vni 1002
   vxlan vrf RED vni 1001
!
mac address-table aging-time 1800
!
ip virtual-router mac-address 00:1c:73:00:dc:01
!
ip address virtual source-nat vrf BLUE address 10.100.101.2
ip address virtual source-nat vrf RED address 10.100.100.2
!
ip access-list standard CVP-ACL
   10 permit 0.0.0.0/0
!
ip access-list standard SNMP-ACL
   10 permit 0.0.0.0/0
!
ip routing
no ip icmp redirect
ip routing vrf BLUE
no ip routing vrf MGMT
ip routing vrf RED
!
mlag configuration
   domain-id DC1_CLEAF1_2
   local-interface Vlan4094
   peer-address 172.16.0.0
   peer-link Port-Channel3
   reload-delay mlag 300
   reload-delay non-mlag 330
!
arp aging timeout default 1500
!
route-map RM-MLAG-PEER-IN permit 10
   description Make routes learned over MLAG Peer-link less preferred on spines to ensure optimal routing
   set origin incomplete
!
router bfd
   multihop interval 3000 min-rx 3000 multiplier 3
!
router bgp 65000.1
   bgp asn notation asdot
   router-id 192.168.100.2
   distance bgp 20 200 200
   graceful-restart restart-time 300
   graceful-restart
   maximum-paths 128 ecmp 128
   no bgp default ipv4-unicast
   timers bgp 5 15
   neighbor default send-community
   neighbor EVPN-OVERLAY-PEERS peer group
   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
   neighbor EVPN-OVERLAY-PEERS bfd
   neighbor EVPN-OVERLAY-PEERS ebgp-multihop 3
   neighbor EVPN-OVERLAY-PEERS password 7 $1c$U41I+zV057R0l38LbPqKww==
   neighbor EVPN-OVERLAY-PEERS send-community
   neighbor EVPN-OVERLAY-PEERS maximum-routes 0
   neighbor MLAG-IPv4-UNDERLAY-PEER peer group
   neighbor MLAG-IPv4-UNDERLAY-PEER remote-as 65000.1
   neighbor MLAG-IPv4-UNDERLAY-PEER next-hop-self
   neighbor MLAG-IPv4-UNDERLAY-PEER description DC1-CL1
   neighbor MLAG-IPv4-UNDERLAY-PEER password 7 $1c$U41I+zV057S2PuXZVQiX2g==
   neighbor MLAG-IPv4-UNDERLAY-PEER send-community
   neighbor MLAG-IPv4-UNDERLAY-PEER maximum-routes 12000
   neighbor MLAG-IPv4-UNDERLAY-PEER route-map RM-MLAG-PEER-IN in
   neighbor 192.168.100.249 peer group EVPN-OVERLAY-PEERS
   neighbor 192.168.100.249 remote-as 65000.0
   neighbor 192.168.100.249 description DC1-SP1
   neighbor 192.168.100.250 peer group EVPN-OVERLAY-PEERS
   neighbor 192.168.100.250 remote-as 65000.0
   neighbor 192.168.100.250 description DC1-SP2
   !
   vlan 10
      rd 192.168.100.2:10010
      route-target both 10010:10010
      redistribute learned
   !
   vlan 20
      rd 192.168.100.2:10020
      route-target both 10020:10020
      redistribute learned
   !
   vlan 30
      rd 192.168.100.2:10030
      route-target both 10030:10030
      redistribute learned
   !
   vlan 40
      rd 192.168.100.2:10040
      route-target both 10040:10040
      redistribute learned
   !
   address-family evpn
      neighbor EVPN-OVERLAY-PEERS activate
   !
   address-family rt-membership
      neighbor EVPN-OVERLAY-PEERS activate
   !
   address-family ipv4
      no neighbor EVPN-OVERLAY-PEERS activate
      neighbor MLAG-IPv4-UNDERLAY-PEER activate
   !
   vrf BLUE
      rd 192.168.100.2:1002
      route-target import evpn 1002:1002
      route-target export evpn 1002:1002
      router-id 192.168.100.2
      neighbor 172.16.1.0 peer group MLAG-IPv4-UNDERLAY-PEER
      redistribute connected
   !
   vrf RED
      rd 192.168.100.2:1001
      route-target import evpn 1001:1001
      route-target export evpn 1001:1001
      router-id 192.168.100.2
      neighbor 172.16.1.0 peer group MLAG-IPv4-UNDERLAY-PEER
      redistribute connected
!
router ospf 100
   router-id 192.168.100.2
   passive-interface default
   no passive-interface Ethernet1
   no passive-interface Ethernet2
   no passive-interface Vlan4093
   max-lsa 12000
!
ip tacacs vrf MGMT source-interface Management1
!
banner login
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                        !!
!! IF THE COMPANY HAS NOT AUTHORISED YOUR ACCESS TO THIS SYSTEM YOU       !!
!! WILL COMMIT A CRIMINAL OFFENCE IF YOU DO NOT IMMEDIATELY DISCONNECT.   !!
!!                                                                        !!
!! UNAUTHORISED ACCESS IS STRICTLY FORBIDDEN AND A DISCIPLINARY OFFENCE.  !!
!!                                                                        !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

EOF

!
management api http-commands
   protocol https
   no protocol http
   no shutdown
   !
   vrf MGMT
      no shutdown
      ip access-group CVP-ACL
!
management console
   idle-timeout 100
!
management security
   password encryption-key common
!
management ssh
   ip access-group SNMP-ACL vrf MGMT in
   idle-timeout 5
   no shutdown
   !
   vrf MGMT
      no shutdown
!
end
