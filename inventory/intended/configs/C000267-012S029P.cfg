!RANCID-CONTENT-TYPE: arista
!
dhcp relay
   tunnel requests disabled
!
vlan internal order ascending range 1006 1199
!
no ip igmp snooping
!
transceiver qsfp default-mode 4x10G
!
service routing protocols model multi-agent
!
hostname C000267-012S029P
ip name-server 10.255.0.2
!
ntp server 0.pool.ntp.org prefer
!
spanning-tree mode mstp
spanning-tree mst 0 priority 4096
!
no enable password
no aaa root
!
vlan 329
   name 000267-Manila-Data
!
vlan 600
   name Guest_Wireless
!
vlan 601
   name Guest_Wired
!
vlan 610
   name IOT_WIRELESS
!
vrf instance MGMT
!
vrf instance VRF_GUEST
!
vrf instance VRF_INTERNAL
!
vrf instance VRF_IOTBMS
!
interface Ethernet1/1/1
   description P2P_LINK_TO_C000267-009R601P_Ethernet3/29/1
   no shutdown
   mtu 1500
   speed forced 100g
   no switchport
   ip address 192.168.3.113/31
   ip ospf network point-to-point
   ip ospf area 0.0.0.0
!
interface Ethernet2/1/1
   description P2P_LINK_TO_C000267-014R602P_Ethernet3/29/1
   no shutdown
   mtu 1500
   speed forced 100g
   no switchport
   ip address 192.168.3.115/31
   ip ospf network point-to-point
   ip ospf area 0.0.0.0
!
interface Loopback0
   description EVPN_Overlay_Peering
   no shutdown
   ip address 192.168.100.29/32
   ip ospf area 0.0.0.0
!
interface Loopback1
   description VTEP_VXLAN_Tunnel_Source
   no shutdown
   ip address 192.168.200.29/32
   ip ospf area 0.0.0.0
!
interface Loopback10
   description VRF_INTERNAL_VTEP_DIAGNOSTICS
   no shutdown
   vrf VRF_INTERNAL
   ip address 167.84.63.29/32
!
interface Loopback20
   description VRF_IOTBMS_VTEP_DIAGNOSTICS
   no shutdown
   vrf VRF_IOTBMS
   ip address 167.84.63.29/32
!
interface Loopback30
   description VRF_GUEST_VTEP_DIAGNOSTICS
   no shutdown
   vrf VRF_GUEST
   ip address 167.84.141.29/32
!
interface Management1
   description oob_management
   no shutdown
   vrf MGMT
   ip address 192.168.0.129/24
!
interface Vlan329
   description 000267-Manila-Data
   no shutdown
   vrf VRF_INTERNAL
   ip helper-address 169.86.42.100
   ip helper-address 169.86.42.132
   ip helper-address 169.98.141.207
   ip helper-address 169.101.114.67
   ip helper-address 169.104.25.67
   ip helper-address 169.127.105.84
   ip helper-address 202.40.72.61
   ip helper-address 202.40.73.61
   ipv6 enable
   ipv6 address virtual fd00:82:0::1/64
   ip address virtual 10.67.122.1/24
!
interface Vlan600
   description Guest_Wireless
   no shutdown
   vrf VRF_GUEST
   ip address virtual 10.120.40.1/22
!
interface Vlan601
   description Guest_Wired
   no shutdown
   vrf VRF_GUEST
   ip address virtual 10.120.44.1/22
!
interface Vlan610
   description IOT_WIRELESS
   no shutdown
   vrf VRF_IOTBMS
   ip address virtual 10.150.0.1/24
!
interface Vxlan1
   description C000267-012S029P_VTEP
   vxlan source-interface Loopback1
   vxlan udp-port 4789
   vxlan vlan 329 vni 10329
   vxlan vlan 600 vni 10600
   vxlan vlan 601 vni 10601
   vxlan vlan 610 vni 10610
   vxlan vrf VRF_GUEST vni 301
   vxlan vrf VRF_INTERNAL vni 101
   vxlan vrf VRF_IOTBMS vni 201
!
ip virtual-router mac-address 00:1c:73:00:dc:01
!
ip address virtual source-nat vrf VRF_GUEST address 167.84.141.29
ip address virtual source-nat vrf VRF_INTERNAL address 167.84.63.29
ip address virtual source-nat vrf VRF_IOTBMS address 167.84.63.29
!
ip routing
no ip routing vrf MGMT
ip routing vrf VRF_GUEST
ip routing vrf VRF_INTERNAL
ip routing vrf VRF_IOTBMS
!
ipv6 unicast-routing
ipv6 unicast-routing vrf VRF_INTERNAL
!
ip extcommunity-list ECL-EVPN-SOO permit soo 192.168.200.29:1
!
route-map RM-EVPN-SOO-IN deny 10
   match extcommunity ECL-EVPN-SOO
!
route-map RM-EVPN-SOO-IN permit 20
!
route-map RM-EVPN-SOO-OUT permit 10
   set extcommunity soo 192.168.200.29:1 additive
!
router bfd
   multihop interval 3000 min-rx 3000 multiplier 3
!
router bgp 65001
   bgp asn notation asdot
   router-id 192.168.100.29
   distance bgp 20 200 200
   graceful-restart restart-time 300
   graceful-restart
   maximum-paths 128 ecmp 128
   update wait-install
   no bgp default ipv4-unicast
   timers bgp 5 15
   neighbor default send-community
   neighbor EVPN-OVERLAY-PEERS peer group
   neighbor EVPN-OVERLAY-PEERS remote-as 65001
   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
   neighbor EVPN-OVERLAY-PEERS bfd
   neighbor EVPN-OVERLAY-PEERS password 7 {{ vault.bgp_peerings.overlay.password }}
   neighbor EVPN-OVERLAY-PEERS send-community
   neighbor EVPN-OVERLAY-PEERS maximum-routes 0
   neighbor 192.168.1.251 peer group EVPN-OVERLAY-PEERS
   neighbor 192.168.1.251 description C000267-009R601P
   neighbor 192.168.1.252 peer group EVPN-OVERLAY-PEERS
   neighbor 192.168.1.252 description C000267-014R602P
   !
   vlan 329
      rd 192.168.100.29:10329
      route-target both 10329:10329
      redistribute dot1x
      redistribute learned
   !
   vlan 600
      rd 192.168.100.29:10600
      route-target both 10600:10600
      redistribute dot1x
      redistribute learned
   !
   vlan 601
      rd 192.168.100.29:10601
      route-target both 10601:10601
      redistribute dot1x
      redistribute learned
   !
   vlan 610
      rd 192.168.100.29:10610
      route-target both 10610:10610
      redistribute dot1x
      redistribute learned
   !
   address-family evpn
      neighbor EVPN-OVERLAY-PEERS route-map RM-EVPN-SOO-IN in
      neighbor EVPN-OVERLAY-PEERS route-map RM-EVPN-SOO-OUT out
      neighbor EVPN-OVERLAY-PEERS activate
   !
   address-family rt-membership
      neighbor EVPN-OVERLAY-PEERS activate
   !
   address-family ipv4
      no neighbor EVPN-OVERLAY-PEERS activate
   !
   vrf VRF_GUEST
      rd 192.168.100.29:301
      route-target import evpn 301:301
      route-target export evpn 301:301
      router-id 192.168.100.29
      redistribute connected
   !
   vrf VRF_INTERNAL
      rd 192.168.100.29:101
      route-target import evpn 101:101
      route-target export evpn 101:101
      router-id 192.168.100.29
      redistribute connected
   !
   vrf VRF_IOTBMS
      rd 192.168.100.29:201
      route-target import evpn 201:201
      route-target export evpn 201:201
      router-id 192.168.100.29
      redistribute connected
!
router ospf 100
   router-id 192.168.100.29
   passive-interface default
   no passive-interface Ethernet1/1/1
   no passive-interface Ethernet2/1/1
   max-lsa 12000
!
banner login
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                        !!
!! IF THE COMPANY HAS NOT AUTHORISED YOUR ACCESS TO THIS SYSTEM YOU       !!
!! WILL COMMIT A CRIMINAL OFFENCE IF YOU DO NOT IMMEDIATELY DISCONNECT.   !!
!!                                                                        !!
!! UNAUTHORISED ACCESS IS STRICTLY FORBIDDEN AND A DISCIPLINARY OFFENCE.  !!
!!                                                                        !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

EOF

!
management api http-commands
   protocol https
   no shutdown
   !
   vrf MGMT
      no shutdown
!
management ssh
   ip access-group SNMP-ACL vrf MGMT in
   idle-timeout 5
   no shutdown
   !
   vrf MGMT
      no shutdown
!
end
